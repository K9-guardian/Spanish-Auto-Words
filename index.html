<!DOCTYPE html>
<html>

<head>
    <style>
        .centerText {
            text-align: center;
        }
        
        .centerTextBox {
            margin: 0px auto;
            width: 80%;
            height: 50vh;
            display: block;
        }
        
        .centerButton {
            margin: auto;
            margin-top: 2%;
            width: auto;
            display: block;
        }
    </style>
</head>

<body>
    <h1 class="centerText">Input</h1>
    <textarea class="centerTextBox" id="inputText"></textarea>
    <button class="centerButton" onclick="makeDoc()">Make Document</button>
    <h1 class="centerText">Output</h1>
    <textarea class="centerTextBox" id="outputText"></textarea>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>
    async function makeDoc() {
        var lines = $("#inputText").val().split(/\s+/);
        var output = $("#outputText");
        var spanishWords = [];
        var definitions = [];
        var sentences = [];
        var outputString = "";
        const proxyurl = "https://cors-anywhere.herokuapp.com/";

        // Get Spanish word and sentence and English Definition
        for (let i = 0; i < lines.length; i++) {
            var english = lines[i];
            const urlSpanish = "https://www.spanishdict.com/translation/" + english;
            const urlDict = "https://www.merriam-webster.com/dictionary/" + english;

            await fetch(proxyurl + urlSpanish)
                .then(response => response.text())
                .then(text => {
                    var index = text.indexOf("<a href=\"/translate/");
                    var spanish = "";
                    var sentence = "";

                    while (text.charAt(index) != '>')
                        index++;

                    index++;

                    while (text.charAt(index) != '<') {
                        spanish += text.charAt(index);
                        index++;
                    }

                    index = text.indexOf("<em class=\"exB\">");

                    while (text.charAt(index) != '>')
                        index++;

                    index++;

                    while (text.charAt(index) != '<') {
                        sentence += text.charAt(index);
                        index++;
                    }

                    console.log(spanish + sentence);
                    spanishWords.push(spanish);
                    sentences.push(sentence);
                });

            await fetch(proxyurl + urlDict)
                .then(response => response.text())
                .then(text => {
                    var index = text.indexOf("<strong class=\"mw_t_bc\">: </strong>");
                    var def = "";

                    while (text.charAt(index) != '>')
                        index++;

                    index++;

                    while (text.charAt(index) != '>')
                        index++;


                    index++;

                    while (text.charAt(index) != '<') {
                        def += text.charAt(index)
                        index++;
                    }
                    def = def.trim();

                    console.log(def);
                    definitions.push(def);
                });
        }

        // Change English Definitions to Spanish Definition
        for (let i = 0; i < definitions.length; i++) {
            var englishDef = definitions[i];
            const testUrl = "https://translate.google.com/#view=home&op=translate&sl=en&tl=es&text=" + englishDef;
            const urlChange = "https://www.spanishdict.com/translation/" + englishDef;

            await fetch(proxyurl + urlChange)
                .then(response => response.text())
                .then(text => {
                    console.log(text);
                });

            await $.get(proxyurl + testUrl, function(responseText) {
                //console.log(responseText);
                var index = responseText.indexOf("\"displayText\"");
                var spanishDef = "";

                /*
                while (responseText.indexOf(index) != ':')
                    index++;

                index += 2;

                while (responseText.indexOf(index) != '"') {
                    spanishDef += responseText.charAt(index);
                    index++;
                }
                console.log(spanishDef);
                definitions[i] = spanishDef;
                */
            });
        }

        // Combine word arrays into one string
        for (var i = 0; i < lines.length; i++) {
            outputString += lines[i] + " - " + spanishWords[i] + "\n";
            outputString += definitions[i] + "\n";
            outputString += sentences[i] + "\n\n";
        }
        output.val(outputString);
    }
</script>

</html>